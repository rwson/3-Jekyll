<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="rwson">
  <!-- Open Graph Data -->
  <meta property="og:title" content="javascript中的序列化"/>
  <meta property="og:description" content="" />
  <meta property="og:site_name" content="小宋"/>
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://yoursite.comundefined"/>
  
    <link rel="alternate" href="/atom.xml" title="小宋" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  

  <!-- Site Title -->
  <title>小宋</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Custom CSS -->
  
  <link rel="stylesheet" href="/css/style.light.css">

  <!-- Google Analytics -->
  

</head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/banner.jpeg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">javascript中的序列化</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/rwson">
                  
                  Github
                  
                </a>
              </li>
            
              <li>
                <a href="mailto:862121312@qq.com">
                  
                  Email
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By rwson</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2016-09-17</span>
          </span>
          
          <!--  Categories  -->
            <span class="categories info">Under 

<a href="/categories/javascript/">javascript</a> / <a href="/categories/javascript/序列化/">序列化</a>
</span>
          
        </div>
        <!-- Tags -->
        
        <!-- Post Main Content -->
        <div class="post-content">
          <p>在用jQuery发送ajax(POST)请求的时候,最常见的提交方式就是”application/x-www-form-urlencoded”,通常都会传入一个data属性作为传输给后端的数据,在ajax发送之前,那么我们直接如果直接传入把这个对象传递给后端,后端就不能对该对象进行解析,因为对象会被转成字符串”[object Object]”,所以就需要我们对该对象进行url编码,并且转换成字符串,再传给后端。</p>
<p>假设我们先传递一个简单的对象(所有的key对应的value都不是引用类型[Array、Object]),就像下面这样:</p>
<pre><code>{
    string: &quot;string&quot;,
    number: 1
}
</code></pre><p>用jQuery中的$.ajax方法,POST提交,打开请求面板,在form data那边,点击view source,可以看到下面这一串字符串,就像下面的样子:</p>
<pre><code>string=string&amp;number=1
</code></pre><p>在jQuery中,$.param这个方法可以实现进行url编码的作用。</p>
<p>现在可以自己实现一个:</p>
<pre><code>//  获取对象上的类名
function _typeOf(obj) {
    return {}.toString.call(obj).slice(8, -1);
}

//  encodeURIComponent简写
function _encode(data) {
    data = data || &quot;&quot;;
    return encodeURIComponent(data);
}

//  序列化主函数
function _serializenData(data) {
    var res = data,
        typeIn;

    //  判断传入的是否是一个Object类型的数据
    if (_typeOf(data) === &quot;Object&quot;) {
        res = [];
        for (var i in data) {
            typeIn = _typeOf(data[i]);
            switch (typeIn) {

                //  遇到Object、Array时需要进行遍历或者枚举,对其内部元素、属性做处理后再放到结果集数组中
                case &quot;Object&quot;:
                    res.push(_loopObject(data[i], i));
                    break;

                case &quot;Array&quot;:
                    res.push(_loopArray(data[i], i));
                    break;

                //  其他类型直接推到结果集数组
                default:
                    res.push(_encode(i) + &quot;=&quot; + _encode(data[i]));
                    break;

            }
        }
        //  把结果集数组转换成&quot;xxx=111&amp;yyy=333&amp;zzz=444&quot;的形式
        res = res.join(&quot;&amp;&quot;).replace(&quot;%20&quot;, &quot;+&quot;)
    }
    return (&quot;&quot; + res);
}

/**
 * 深层遍历一个数组
 * @param  {[type]} array [description]
 * @param  {[type]} key   [description]
 * @return {[type]}       [description]
 */
function _loopArray(array, key) {
    var res = [],
        typeIn;
    for (var i = 0, len = array.length; i &lt; len; i++) {

        //  获取每一项的类名,如果是Object/则递归调用_loopArray/_loopObject,传入当前项和属性名,处理子项,再放到结果集中
        typeIn = _typeOf(array[i]);
        switch (typeIn) {

            case &quot;Array&quot;:
                res.push(_loopArray(array[i], (key + &quot;[&quot; + i + &quot;]&quot;)));
                break;

            case &quot;Object&quot;:
                res.push(_loopObject(array[i], (key + &quot;[&quot; + i + &quot;]&quot;)));
                break;

            //    其他类型的直接推到结果集数组
            default:
                res.push(_encode(key + &quot;[]&quot;) + &quot;=&quot; + _encode((&quot;&quot; + array[i])));
                break;

        }
    }

    //  把结果集转换成&quot;xxx=111&amp;yyy=333&amp;zzz=444&quot;的形式
    return res.join(&quot;&amp;&quot;);
}

/**
 * 深层遍历一个对象
 * @param  {[type]} object [description]
 * @param  {[type]} key    [description]
 * @return {[type]}        [description]
 */
function _loopObject(object, key) {
    var res = [],
        typeIn;
    for (var i in object) {
        //  取得一个当前key对应value的类名,如果是Object/Array,则进行递归调用
        typeIn = _typeOf(object[i]);
        switch (typeIn) {
            case &quot;Array&quot;:
                res.push(_loopArray(object[i], key + &quot;[&quot; + i + &quot;]&quot;));
                break;

            case &quot;Object&quot;:
                res.push(_loopObject(object[i], key + &quot;[&quot; + i + &quot;]&quot;));
                break;

            //    其他类型的直接推到结果集数组中
            default:
                res.push(_encode(key + &quot;[&quot; + i + &quot;]&quot;) + &quot;=&quot; + _encode((&quot;&quot; + object[i])));
                break;
        }
    }

    //  把结果集转换成&quot;xxx=111&amp;yyy=333&amp;zzz=444&quot;的形式
    return res.join(&quot;&amp;&quot;);
}
</code></pre><p>下面我们模拟几个复杂点的对象,调用封装的序列化方法,和$.param进行对比:</p>
<pre><code>var obj = {
    string: &quot;string&quot;,
    number: 1,
    array: [1, 2, 3, 4, 5]
};

var obj2 = {
    string: &quot;string&quot;,
    number: 1,
    array: [
        1, 2, 3, 4, 5, {
            key1: &quot;value1&quot;,
            key2: &quot;value2&quot;,
            key3: &quot;value3&quot;
        }
    ]
};

var obj3 = {
    array: [1, 2, 3, 4, 5],
    arrayobject: [{
        key1: &quot;value1&quot;,
        key2: &quot;value2&quot;,
        key3: &quot;value3&quot;
    }, {
        key1: &quot;value1&quot;,
        key2: &quot;value2&quot;,
        key3: &quot;value3&quot;
    }, {
        key1: &quot;value1&quot;,
        key2: &quot;value2&quot;,
        key3: &quot;value3&quot;
    }]
};

var deepObj1 = {
    arr: [{
        string: &quot;string&quot;,
        number: 1,
        arr: [1, 2, 3, 4],
        mixArr: [{
            key1: &quot;value1&quot;,
            key2: &quot;value2&quot;
        }, {
            key1: &quot;value1&quot;,
            key2: &quot;value2&quot;
        }, {
            key1: &quot;value1&quot;,
            key2: &quot;value2&quot;
        }]
    }]
};

var deepObj2 = {
    obj: {
        key1: &quot;value1&quot;,
        key2: &quot;value2&quot;,
        key3: &quot;value3&quot;
    },
    array: [1, 2, 3, 4, 5],
    objectArray: {
        array: [1, 2, 3, 4, 5, {
            key1: &quot;value1&quot;,
            key2: &quot;value2&quot;,
            key3: &quot;value3&quot;
        }]
    },
    arrayObj: [{
        key1: &quot;value1&quot;,
        key2: &quot;value2&quot;,
        key3: &quot;value3&quot;
    }, {
        key1: &quot;value1&quot;,
        key2: &quot;value2&quot;,
        key3: &quot;value3&quot;
    }, {
        key1: &quot;value1&quot;,
        key2: &quot;value2&quot;,
        key3: &quot;value3&quot;
    }]
};

//  打开控制台的console面板,查看输出

console.group(&quot;serialize obj&quot;);
console.log(_serializenData(obj));  //  ...
console.log($.param(obj));  //  ...
console.log(_serializenData(obj) === $.param(obj)); //  true
console.groupEnd();

console.group(&quot;serialize obj2&quot;);
console.log(_serializenData(obj2)); //  ...
console.log($.param(obj2)); //  ...
console.log(_serializenData(obj2) === $.param(obj2));   //  true
console.groupEnd();    

console.group(&quot;serialize obj3&quot;);
console.log(_serializenData(obj3)); //  ...
console.log($.param(obj3)); //  ...
console.log(_serializenData(obj3) === $.param(obj3));   //  true
console.groupEnd();

console.group(&quot;serialize deepObj1&quot;);
console.log(_serializenData(deepObj1)); //  ...
console.log($.param(deepObj1)); //  ...
console.log(_serializenData(deepObj1) === $.param(deepObj1));   //  true
console.groupEnd();

console.group(&quot;serialize deepObj2&quot;);
console.log(_serializenData(deepObj2)); //  ...
console.log($.param(deepObj2)); //  ...
console.log(_serializenData(deepObj2) === $.param(deepObj2));   //  true
console.groupEnd();
</code></pre>
        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Build By <a target="_blank" href="https://github.com/rwson">rwson</a>
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->
<script src="/js/highlight.pack.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

